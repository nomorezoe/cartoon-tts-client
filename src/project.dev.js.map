{"version":3,"sources":["assets/Scripts/game/Ballon.js","assets/Scripts/game/CamMove.js","assets/Scripts/game/Eye.js","assets/Scripts/game/Game.js","assets/Scripts/loading/Loading.js","assets/Scripts/game/MusicToggle.js"],"names":["cc","Class","extends","Component","properties","whiteBG","Node","pinkBG","text","Label","start","update","this","updateTextHeight","node","height","bg","Math","max","init","isFurwee","color","Color","active","string","step","x","opacity","parent","removeChild","CamAdjust","cameras","Camera","sceneNodes","infos","vx","vy","ax","maxV","rotRangeX","rotRangeY","screenWidth","designResolutionHeight","designResolutionHeight_2","onLoad","view","getDesignResolutionSize","getCanvasSize","width","i","length","info","eulerAngles","y","push","on","EventType","TOUCH_MOVE","onTouchMove","MOUSE_MOVE","onMouseMove","onDestroy","off","evt","targetY","_x","targetX","pow","_y","currentX","currentY","timeY","abs","timeX","rotate3DTo","v3","stopAllActions","runAction","easing","easeOut","stage","eye","isLeft","Boolean","randX","randY","touchMoveHandler","mouseMoveHandler","worldPos","convertToWorldSpaceAR","v2","getLocationX","getLocationY","pos","convertToNodeSpaceAR","len","tan","ctan","posX","posY","mouseLen2","factor","min","len2","setPosition","MusicToggle","require","editBox","EditBox","audioID","mouthNode","mouthIsReset","historyObjects","sendButton","balloonPrefab","Prefab","balloonNode","introSound","type","AudioClip","default","music","blockerNode","idleMouthTimeout","isLocalHost","window","location","href","indexOf","console","log","onTextLenChange","handleConnect","socket","id","startFurwee","msg","addBallon","audioInfo","audio_offset_ms","viseme_id","audioEngine","play","audioOffset","updateMouth","setFinishCallback","bind","onTTSCompleted","JSON","stringify","lip_sync_animation","remoteUrl","audio_file_link","loader","load","url","err","res","stopIdleMouth","sendHandler","sendText","trim","that","xhr","XMLHttpRequest","requestURL","onreadystatechange","readyState","DONE","status","json","parse","responseText","index","reply","message","params","hitory","open","setRequestHeader","send","getChildByName","clearMouth","dt","time","getCurrentTime","startIdleMouth","textContent","children","getComponent","balloon","instantiate","addChild","startSound","initialize","node2","_i","_node","setIdleMouth","clearTimeout","idle","floor","random","setTimeout","progressBar","ProgressBar","director","preloadScene","onProgress","onComplete","completedCount","totalCount","progress","error","loadScene","onNode","offNode","hintNode","hintText","audioId","anim","Animation","isMusicOn","sys","localStorage","getItem","toggleOn","toggleOff","toggleOver","toggleOut","pauseMusic","resumeMusic","playMusic"],"mappings":"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","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        whiteBG: cc.Node,\n        pinkBG: cc.Node,\n        text: cc.Label,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n\n    },\n\n    // update (dt) {},\n\n    update() {\n        if (this.updateTextHeight) {\n            this.node.height = this.bg.height = Math.max(55, this.text.node.height + 20);\n            this.updateTextHeight = false;\n        }\n    },\n\n    init(text, isFurwee) {\n\n        if (isFurwee) {\n            this.text.node.color = new cc.Color(\"#63697B\");\n            this.pinkBG.active = false;\n            this.whiteBG.active = true;\n\n            this.bg = this.whiteBG;\n        }\n        else {\n            this.text.node.color = new cc.Color(\"#FFFFFF\");\n            this.whiteBG.active = false;\n            this.pinkBG.active = true;\n\n            this.bg = this.pinkBG;\n        }\n        this.isFurwee = isFurwee;\n        this.text.string = text;\n        this.updateTextHeight = true;\n\n    },\n\n    step() {\n        if (this.isFurwee) {\n            this.node.x -= 20;\n        }\n        else {\n            this.node.x += 20;\n        }\n\n        this.node.opacity -= 50;\n\n        if(this.node.opacity <=0){\n            this.node.parent.removeChild(this.node);\n        }\n    },\n\n\n});\n","let CamAdjust = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        cameras: [cc.Camera],\n        sceneNodes: [cc.Node],\n        infos: null,\n        vx: 0,\n        vy: 0,\n        ax: 0.1,\n        maxV: 0.3,\n\n        /*rotX:0,\n        rotY:0,\n\n        posX: 0, \n        posY: 0,*/\n\n        rotRangeX: 1,\n        rotRangeY: 10,\n\n        //moveRangeX: 50,\n        //moveRangeY: 10,\n\n        screenWidth: 0,\n        designResolutionHeight: 0,\n        designResolutionHeight_2: 0,\n    },\n\n    onLoad: function () {\n        this.screenWidth = cc.view.getDesignResolutionSize().height / cc.view.getCanvasSize().height * cc.view.getCanvasSize().width;\n        this.designResolutionHeight = cc.view.getDesignResolutionSize().height;\n        this.designResolutionHeight_2 = cc.view.getDesignResolutionSize().height / 2;\n        /*this.rotX =  this.cameras[0].node.eulerAngles.x;\n        this.rotY =  this.cameras[0].node.eulerAngles.y;\n\n        this.posX = this.cameras[0].node.position.x;\n        this.posY = this.cameras[0].node.position.y;\n        //console.log(this.rotX, this.rotY);*/\n        this.infos = [];\n        for (let i = 0; i < this.sceneNodes.length; i++) {\n            let info = { x: this.sceneNodes[i].eulerAngles.x, y: this.sceneNodes[i].eulerAngles.y };\n            this.infos.push(info);\n        }\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.MOUSE_MOVE, this.onMouseMove, this);\n\n\n    },\n\n    onDestroy: function () {\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.MOUSE_MOVE, this.onMouseMove, this);\n    },\n\n    onTouchMove: function (evt) {\n        // this.onMouseMove(evt);\n    },\n\n    onMouseMove: function (evt) {\n        // console.log(this.screenWidth/2 - evt._x, this.screenWidth/2);\n        let targetY = (this.screenWidth / 2 - evt._x) / (this.screenWidth / 2) * this.rotRangeY;\n        let targetX = - Math.pow(1 - evt._y / this.designResolutionHeight, 3) * this.rotRangeX * 2;\n\n        //let targetMoveX = (this.screenWidth/2 - evt._x)/ (this.screenWidth/2) * this.moveRangeX + this.posX;\n        //let targetMoveY = ( evt._y - this.designResolutionHeight_2 ) / this.designResolutionHeight_2 *this.moveRangeY + this.posY;\n\n        // console.log(\"target\", targetX, targetY);\n        let currentX = this.sceneNodes[0].eulerAngles.x;\n        let currentY = this.sceneNodes[0].eulerAngles.y;\n\n        let timeY = Math.abs(targetY - currentY) / this.rotRangeY;\n        let timeX = Math.abs(targetX - currentX) / this.rotRangeX;\n        //console.log('time', timeX, timeY);\n\n        for (let i = 0; i < this.sceneNodes.length; i++) {\n\n            let rotate3DTo = cc.rotate3DTo(Math.max(timeX, timeY), cc.v3(targetX + this.infos[i].x, targetY + this.infos[i].y, 0));\n            // let move3DTo = cc.moveTo(1, cc.v3(targetMoveX, targetMoveY, 0));\n            //console.log(targetMoveX,targetMoveY);\n            // this.cameras[i].node.stopAllActions();\n            // this.cameras[i].node.runAction(cc.spawn(rotate3DTo, move3DTo));\n\n\n            this.sceneNodes[i].stopAllActions();\n            this.sceneNodes[i].runAction(rotate3DTo.easing(cc.easeOut(1.0)));\n        }\n\n    },\n});","cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        stage: cc.Node,\n        eye: cc.Node,\n        isLeft: cc.Boolean\n    },\n\n    onLoad() {\n        this.randX = 8;\n        this.randY = 1.5;\n        // this.stage.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);\n        // this.stage.on(cc.Node.EventType.MOUSE_MOVE, this.mouseMoveHandler, this);\n    },\n\n    touchMoveHandler(evt) {\n        //console.log(evt);\n    },\n\n    mouseMoveHandler(evt) {\n\n        let worldPos = this.stage.convertToWorldSpaceAR(cc.v2(evt.getLocationX(), evt.getLocationY()));\n        //console.log(\"world\",worldPos.x, worldPos.y);\n        worldPos = cc.v2(evt.getLocationX(), evt.getLocationY());\n        let pos = this.node.convertToNodeSpaceAR(worldPos);\n        //console.log(pos.x , pos.y);\n\n        //this.eye.setPosition(pos.x, pos.y);\n\n        let len = 0;\n        let tan = 0;\n        let ctan = 0;\n\n        let posX = 0;\n        let posY = 0;\n\n        if (pos.x != 0 && pos.y != 0) {\n\n            let mouseLen2 = Math.pow(pos.x, 2) * Math.pow(pos.y, 2) / (Math.pow(pos.x, 2) + Math.pow(pos.y, 2));\n            if (mouseLen2 > Math.pow(150, 2)) {\n                posX = 0;\n                posY = 0;\n\n            }\n            else {\n                let factor = Math.min(Math.pow(mouseLen2, 0.5) / 40, 1);\n                //factor = Math.pow(factor, 2);\n                if (this.isLeft) {\n                    pos.x -= 40 * factor;\n                }\n                else {\n                    pos.x += 40 * factor;\n                }\n                if (pos.x < 0) {\n                    pos.x = Math.max(pos.x, -8);\n                }\n                else {\n                    pos.x = Math.min(pos.x, 8);\n                }\n                if (pos.y < 0) {\n                    pos.y = Math.max(pos.y, -2.5);\n                }\n                else {\n                    pos.y = Math.min(pos.y, 2.5);\n                }\n                let len2 = Math.pow(pos.x, 2) * Math.pow(pos.y, 2) / (Math.pow(pos.x, 2) + Math.pow(pos.y, 2));\n                len = Math.pow(len2, 0.5);\n\n                tan = pos.y / len;\n                ctan = pos.x / len;\n\n                posX = len * ctan;\n                posY = len * tan;\n\n            }\n\n        }\n\n        this.eye.setPosition(posX, posY);\n        //console.log(\"set pos\", posX, posY);\n\n    }\n})","let MusicToggle = require(\"MusicToggle\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        editBox: cc.EditBox,\n        audioID: -1,\n        mouthNode: cc.Node,\n        mouthIsReset: true,\n        historyObjects: [],\n        sendButton: cc.Node,\n\n        balloonPrefab: cc.Prefab,\n        balloonNode: cc.Node,\n\n        introSound: {\n            type: cc.AudioClip,\n            default: null\n        },\n\n        music: MusicToggle,\n        blockerNode: cc.Node,\n        idleMouthTimeout: -1\n    },\n\n    start() {\n        this.blockerNode.active = true;\n    },\n\n    onLoad() {\n\n        let isLocalHost = false;\n        if (window.location.href.indexOf(\"localhost\") != -1 || window.location.href.indexOf(\"127.0.0.1\") != -1) {\n            isLocalHost = true;\n        }\n        console.log(\"isLocalHost\", isLocalHost);\n\n        /*\n        this.urlAddress = isLocalHost ? \"http://127.0.0.1:3000\" : \"http://13.115.222.147:3000\";\n        this.socket = new window.io(this.urlAddress, { transports: ['websocket', 'polling', 'flashsocket'] });\n\n        this.socket.on(\"connect\", this.handleConnect.bind(this));\n        this.socket.on(\"onTTSCompleted\", this.onTTSCompleted.bind(this));\n\n        return;\n\n*/\n        this.onTextLenChange(this.editBox.string);\n\n\n    },\n\n    handleConnect() {\n        console.log('connected', this.socket.id);\n    },\n\n    startFurwee() {\n\n\n        let msg = \"Hi, my name is Furwee. What's your name?\";\n        this.addBallon(msg, true);\n        //return;\n\n        this.audioInfo = [{ \"audio_offset_ms\": 50, \"viseme_id\": 0 }, { \"audio_offset_ms\": 100, \"viseme_id\": 12 }, { \"audio_offset_ms\": 237.5, \"viseme_id\": 11 }, { \"audio_offset_ms\": 475, \"viseme_id\": 0 }, { \"audio_offset_ms\": 650, \"viseme_id\": 21 }, { \"audio_offset_ms\": 687.5, \"viseme_id\": 11 }, { \"audio_offset_ms\": 762.5, \"viseme_id\": 19 }, { \"audio_offset_ms\": 850, \"viseme_id\": 4 }, { \"audio_offset_ms\": 893.75, \"viseme_id\": 6 }, { \"audio_offset_ms\": 937.5, \"viseme_id\": 21 }, { \"audio_offset_ms\": 1000, \"viseme_id\": 6 }, { \"audio_offset_ms\": 1062.5, \"viseme_id\": 15 }, { \"audio_offset_ms\": 1150, \"viseme_id\": 18 }, { \"audio_offset_ms\": 1212.5, \"viseme_id\": 5 }, { \"audio_offset_ms\": 1287.5, \"viseme_id\": 13 }, { \"audio_offset_ms\": 1350, \"viseme_id\": 7 }, { \"audio_offset_ms\": 1400, \"viseme_id\": 6 }, { \"audio_offset_ms\": 1662, \"viseme_id\": 0 }, { \"audio_offset_ms\": 2425, \"viseme_id\": 0 }, { \"audio_offset_ms\": 2475, \"viseme_id\": 7 }, { \"audio_offset_ms\": 2575, \"viseme_id\": 1 }, { \"audio_offset_ms\": 2637.5, \"viseme_id\": 19 }, { \"audio_offset_ms\": 2687.5, \"viseme_id\": 15 }, { \"audio_offset_ms\": 2737.5, \"viseme_id\": 6 }, { \"audio_offset_ms\": 2787.5, \"viseme_id\": 3 }, { \"audio_offset_ms\": 2825, \"viseme_id\": 13 }, { \"audio_offset_ms\": 2862.5, \"viseme_id\": 19 }, { \"audio_offset_ms\": 2925, \"viseme_id\": 4 }, { \"audio_offset_ms\": 3025, \"viseme_id\": 6 }, { \"audio_offset_ms\": 3125, \"viseme_id\": 21 }, { \"audio_offset_ms\": 3300, \"viseme_id\": 0 }]\n        this.audioID = cc.audioEngine.play(this.introSound);\n        this.audioOffset = 0;\n        this.updateMouth();\n\n        cc.audioEngine.setFinishCallback(this.audioID, function () {\n            this.audioID = -1;\n            this.mouthIsReset = false;\n        }.bind(this));\n\n    },\n\n    onTTSCompleted(info) {\n        console.log(JSON.stringify(info.info));\n        if (!info) {\n            return;\n        }\n\n        this.audioInfo = info.lip_sync_animation;\n\n        let remoteUrl = info.audio_file_link;\n        cc.loader.load({ url: remoteUrl, type: 'wav' }, function (err, res) {\n            // Use texture to create sprite frame\n            this.audioID = cc.audioEngine.play(res);\n            this.audioOffset = 0;\n            this.stopIdleMouth();\n            this.updateMouth();\n\n            cc.audioEngine.setFinishCallback(this.audioID, function () {\n                this.audioID = -1;\n                this.mouthIsReset = false;\n            }.bind(this));\n        }.bind(this));\n    },\n\n    sendHandler() {\n        let sendText = this.editBox.string;\n        if (sendText.trim().length == 0) {\n            return;\n        }\n\n        /* this.socket.emit(\"tts\", sendText);\n         return;\n */\n\n        this.addBallon(sendText, false);\n        this.editBox.string = \"\";\n        this.onTextLenChange(this.editBox.string);\n\n        let that = this;\n        let xhr = new XMLHttpRequest();\n\n        let requestURL = \"http://40.121.137.102/messages/\";\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState == XMLHttpRequest.DONE) {\n                if (xhr.status == 200) {\n                    let json = JSON.parse(xhr.responseText);\n                    that.onTTSCompleted(json);\n\n                    that.historyObjects.push({ \"index\": that.historyObjects.length, \"reply\": json.reply, \"message\": json.message });\n\n                    that.addBallon(json.reply, true);\n                }\n            }\n        }\n        let params = JSON.stringify({ \"message\": sendText, hitory: this.historyObjects });\n        xhr.open('POST', requestURL, true);\n        xhr.setRequestHeader('Content-type', 'application/json');\n        xhr.send(params);\n    },\n\n    updateMouth() {\n        //audio_offset_ms: 1162.5, viseme_id: 11}\n        let id = this.audioInfo[this.audioOffset].viseme_id;\n\n        let node = this.mouthNode.getChildByName(\"mouth_\" + id);\n        if (node) {\n            this.clearMouth();\n            node.active = true;\n        }\n    },\n\n    update(dt) {\n        if (this.audioID != -1) {\n            let time = cc.audioEngine.getCurrentTime(this.audioID)\n\n            while (this.audioInfo.length > this.audioOffset\n                && (this.audioInfo[this.audioOffset].audio_offset_ms < time * 1000 + 15)) {\n                // && ((this.audioOffset + 1 >= this.audioInfo.length) || (Math.abs(this.audioInfo[this.audioOffset ].audioOffset - time* 1000 ) > (this.audioInfo[this.audioOffset +1].audioOffset - time* 1000 )))){\n                this.updateMouth();\n                this.audioOffset += 1;\n\n            }\n        }\n        else {\n            if (!this.mouthIsReset) {\n                this.mouthIsReset = true;\n                this.clearMouth();\n                this.mouthNode.getChildByName(\"mouth_0\").active = true;\n                this.startIdleMouth();\n            }\n        }\n    },\n\n    onTextLenChange(textContent) {\n        this.sendButton.active = textContent.length != 0\n    },\n\n    addBallon(message, isFurwee) {\n        for (var i = 0; i < this.balloonNode.children.length; ++i) {\n            this.balloonNode.children[i].getComponent(\"Ballon\").step();\n        }\n\n        let balloon = cc.instantiate(this.balloonPrefab);\n        balloon.getComponent('Ballon').init(message, isFurwee);\n        this.balloonNode.addChild(balloon);\n\n\n    },\n\n    startSound() {\n        this.blockerNode.active = false;\n        this.music.initialize();\n        this.startFurwee();\n    },\n\n    clearMouth() {\n        for (let i = 0; i <= 21; i++) {\n            let node2 = this.mouthNode.getChildByName(\"mouth_\" + i);\n            node2.active = false;\n        }\n\n        for (let i = 0; i < 2; i++) {\n            let node2 = this.mouthNode.getChildByName(\"idle_\" + i);\n            node2.active = false;\n        }\n    },\n\n    startIdleMouth() {\n        this.setIdleMouth();\n    },\n\n    setIdleMouth() {\n        clearTimeout(this.idleMouthTimeout);\n        this.idleMouthTimeout = -1;\n\n        this.clearMouth();\n        let idle = Math.floor(Math.random() * 2);\n        this.mouthNode.getChildByName(\"idle_\" + idle).active = true;\n\n        setTimeout(this.setIdleMouth.bind(this), 3000 * Math.random() + 3000);\n    },\n\n    stopIdleMouth() {\n        clearTimeout(this.idleMouthTimeout);\n        this.idleMouthTimeout = -1;\n    },\n\n});\n","// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        progressBar:cc.ProgressBar,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    onLoad () {\n        cc.director.preloadScene(\"game\", this.onProgress.bind(this), this.onComplete.bind(this));\n    },\n\n    onProgress(completedCount, totalCount){\n        this.progressBar.progress = completedCount/totalCount;\n    },\n\n    onComplete(error){\n        if(!error){\n            cc.director.loadScene(\"game\");\n        }\n\n    }\n\n    \n});\n","let MusicToggle = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        onNode: cc.Node,\n        offNode: cc.Node,\n        hintNode: cc.Node,\n        hintText: cc.Label,\n        audioId: null,\n        music: {\n            type: cc.AudioClip,\n            default: null\n        },\n        anim: cc.Animation\n    },\n\n    initialize() {\n        this.isMusicOn = cc.sys.localStorage.getItem(\"music\");\n        if (this.isMusicOn == null) {\n            this.isMusicOn = true;\n        }\n\n        if (this.isMusicOn) {\n            this.toggleOn();\n            /*setTimeout(function(){ \n                cc.sys.__audioSupport.context.resume();\n                cc.game.canvas.dispatchEvent(new Event(\"mousedown\"))\n            }, 3000);*/\n        }\n        else {\n            this.toggleOff();\n        }\n\n\n\n        // this.node.on(\"mouseOver\")\n\n    },\n\n    toggleOver() {\n        this.hintNode.active = true;\n    },\n\n    toggleOut() {\n        this.hintNode.active = false;\n    },\n\n\n    toggleOff() {\n        this.onNode.active = true;\n        this.offNode.active = false;\n        this.hintText.string = \"Turn Volumn On\";\n\n        if (this.audioId != null) {\n            cc.audioEngine.pauseMusic();\n        }\n\n\n    },\n\n    toggleOn() {\n        this.offNode.active = true;\n        this.onNode.active = false;\n        this.hintText.string = \"Turn Volumn Off\";\n\n        if (!this.audioId) {\n            this.audioId = cc.audioEngine.playMusic(this.music, true);\n        }\n        else {\n            cc.audioEngine.resumeMusic();\n        }\n    }\n\n});"],"file":"project.dev.js"}